# Story 8.8: Mobile-First Responsive Design

## Status
Ready for Development

## Story
**As a** mobile user,
**I want** the application to work well on my device,
**so that** I can use it anywhere

## Acceptance Criteria
1. All pages responsive at 320px, 768px, 1024px, 1440px
2. Touch-friendly tap targets (min 44px)
3. Swipe gestures for navigation
4. Bottom navigation on mobile
5. Collapsible panels on small screens
6. Optimized data tables for mobile

## Tasks / Subtasks
- [ ] **Task 1: Audit all pages at breakpoints** (AC: 1)
  - [ ] Test dashboard at all breakpoints
  - [ ] Check TPN calculator responsiveness
  - [ ] Verify ingredient manager on mobile
  - [ ] Test editor layout stacking
  - [ ] Check comparison page on tablets
  - [ ] Document issues found
  - [ ] Create responsive fixes checklist

- [ ] **Task 2: Implement mobile navigation** (AC: 4)
  - [ ] Create MobileNav at `src/widgets/mobile-nav/ui/MobileNav.tsx`
  - [ ] Design bottom navigation bar
  - [ ] Add main action buttons (Home, Calculator, Editor, More)
  - [ ] Implement active state indicators
  - [ ] Hide on desktop breakpoints
  - [ ] Add slide-up animation
  - [ ] Test navigation functionality

- [ ] **Task 3: Create responsive table component** (AC: 6)
  - [ ] Build ResponsiveTable at `src/shared/ui/organisms/ResponsiveTable/ResponsiveTable.tsx`
  - [ ] Implement card view for mobile
  - [ ] Add horizontal scroll for tablets
  - [ ] Create column priority system
  - [ ] Add show/hide columns toggle
  - [ ] Test with ingredient data
  - [ ] Verify with calculation results

- [ ] **Task 4: Add touch gesture support** (AC: 3)
  - [ ] Integrate touch gesture library (Hammer.js or similar)
  - [ ] Add swipe to delete on sections
  - [ ] Implement pull-to-refresh
  - [ ] Add swipe navigation between tabs
  - [ ] Create gesture hints/tutorials
  - [ ] Test on actual devices

- [ ] **Task 5: Optimize form layouts for mobile** (AC: 2, 5)
  - [ ] Stack form fields vertically on mobile
  - [ ] Increase input heights to 44px minimum
  - [ ] Add proper input types (number, email, etc.)
  - [ ] Implement collapsible form sections
  - [ ] Create floating labels for space saving
  - [ ] Test form usability on mobile

- [ ] **Task 6: Implement progressive disclosure** (AC: 5)
  - [ ] Create CollapsiblePanel component
  - [ ] Add expand/collapse to complex sections
  - [ ] Implement accordion pattern for settings
  - [ ] Hide secondary actions in menus
  - [ ] Add "More" buttons for additional options
  - [ ] Test information hierarchy

- [ ] **Task 7: Optimize editor for mobile** (AC: 1, 5)
  - [ ] Stack editor and preview vertically
  - [ ] Create tab switcher for Preview/Output
  - [ ] Implement full-screen code editor mode
  - [ ] Add toolbar that scrolls horizontally
  - [ ] Create mobile-friendly test panel
  - [ ] Test editing experience on phones

- [ ] **Task 8: Performance optimization for mobile** (AC: 1)
  - [ ] Implement lazy loading for images
  - [ ] Add virtual scrolling for long lists
  - [ ] Optimize bundle size with code splitting
  - [ ] Reduce initial JavaScript payload
  - [ ] Test on slow 3G connections
  - [ ] Measure and improve Core Web Vitals

## Dev Notes

### Previous Story Context
- Stories 8.1-8.7: All main pages created
- Parent app shows some mobile considerations
- Need comprehensive mobile optimization

### Architecture References

#### Breakpoint System
```scss
// Breakpoints from Tailwind
$mobile: 320px;    // sm
$tablet: 768px;    // md
$desktop: 1024px;  // lg
$wide: 1440px;     // xl

// Material UI breakpoints
const theme = createTheme({
  breakpoints: {
    values: {
      xs: 0,
      sm: 320,
      md: 768,
      lg: 1024,
      xl: 1440,
    },
  },
});
```

#### Project Structure [Source: architecture/source-tree.md]
Mobile components location:
```
src/
├── widgets/
│   └── mobile-nav/       # Mobile navigation
│       └── ui/
│           └── MobileNav.tsx
├── shared/ui/
│   ├── organisms/
│   │   └── ResponsiveTable/
│   └── molecules/
│       └── CollapsiblePanel/
└── hooks/
    ├── useBreakpoint.ts  # Breakpoint detection
    ├── useTouch.ts       # Touch gestures
    └── useMobile.ts      # Mobile detection
```

### Mobile-Specific Patterns

#### Touch Targets
```typescript
// Minimum touch target sizes
const TOUCH_TARGET = {
  minHeight: 44, // iOS guideline
  minWidth: 44,
  padding: 8,
};
```

#### Responsive Table Pattern
```typescript
interface ResponsiveTableProps {
  data: any[];
  columns: ColumnDef[];
  mobileView?: 'cards' | 'scroll';
  priorityColumns?: string[]; // Show on mobile
}
```

#### Mobile Navigation Structure
```typescript
interface MobileNavItem {
  icon: ReactNode;
  label: string;
  path: string;
  badge?: number;
}

const mobileNavItems: MobileNavItem[] = [
  { icon: <HomeIcon />, label: 'Home', path: '/' },
  { icon: <CalculateIcon />, label: 'Calculator', path: '/tpn/calculator' },
  { icon: <EditIcon />, label: 'Editor', path: '/editor' },
  { icon: <MoreIcon />, label: 'More', path: '/menu' },
];
```

### Gesture Implementation
```typescript
// Swipe gestures
const useSwipeGesture = (onSwipe: (direction: string) => void) => {
  // Detect swipe direction
  // Call onSwipe with 'left', 'right', 'up', 'down'
};
```

### Performance Targets
- **First Contentful Paint**: < 1.8s
- **Time to Interactive**: < 3.9s
- **Cumulative Layout Shift**: < 0.1
- **Bundle Size**: < 200KB initial

### Testing Requirements

#### Testing Standards [Source: architecture/testing-strategy.md]
- **Device Testing**: Real devices + Chrome DevTools
- **Framework**: Vitest + Playwright for E2E

Key Test Scenarios:
1. Navigation works with touch
2. Forms are usable on small screens
3. Tables display correctly on mobile
4. Gestures work as expected
5. Performance meets targets
6. Offline functionality works
7. Text remains readable
8. No horizontal scroll (except tables)

### Accessibility on Mobile
- Touch targets meet minimum size
- Pinch-to-zoom not disabled
- Text scales properly
- Contrast ratios maintained
- Screen reader support
- Keyboard navigation available

### Progressive Web App Considerations
```json
// manifest.json additions
{
  "display": "standalone",
  "orientation": "portrait",
  "theme_color": "#1976d2",
  "background_color": "#ffffff"
}
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-06 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
_To be populated by development agent_

### Agent Model Used
_To be populated_

### Debug Log References
_To be populated_

### Completion Notes List
_To be populated_

### File List
_To be populated_

## QA Results
_To be populated by QA agent_