# Story 8.2: Dashboard/Home Page

## Status
Ready for Development

## Story
**As a** clinician,
**I want** a dashboard showing my recent work,
**so that** I can quickly resume tasks

## Acceptance Criteria
1. Welcome message with user context
2. Recent TPN calculations (last 5)
3. Recent ingredients (last 10)
4. Quick action buttons
5. Statistics cards (total calculations, ingredients)
6. Empty states for new users

## Tasks / Subtasks
- [ ] **Task 1: Create DashboardPage component** (AC: 1, 6)
  - [ ] Create page component at `src/app/(dashboard)/page.tsx`
  - [ ] Implement welcome message with user name from auth context
  - [ ] Set up responsive grid layout using Material UI Grid
  - [ ] Add empty state detection logic
  - [ ] Implement conditional rendering for new vs returning users
  - [ ] Write unit tests for dashboard logic

- [ ] **Task 2: Build RecentActivity component** (AC: 2, 3)
  - [ ] Create RecentActivity at `src/pages/home/ui/RecentActivity.tsx`
  - [ ] Implement TPN calculations list with last 5 items
  - [ ] Create ingredients list showing last 10 items
  - [ ] Add timestamp formatting
  - [ ] Include links to view/edit items
  - [ ] Style with Material UI List components
  - [ ] Create loading skeletons
  - [ ] Write tests for data display

- [ ] **Task 3: Create StatCard component** (AC: 5)
  - [ ] Create StatCard at `src/shared/ui/molecules/StatCard/StatCard.tsx`
  - [ ] Design card with icon, title, value, and trend
  - [ ] Add number formatting for large values
  - [ ] Implement color coding for different stat types
  - [ ] Create TypeScript interfaces for props
  - [ ] Add Storybook stories for variations
  - [ ] Write unit tests

- [ ] **Task 4: Implement QuickActions component** (AC: 4)
  - [ ] Create QuickActionGrid at `src/shared/ui/molecules/QuickActionGrid/QuickActionGrid.tsx`
  - [ ] Define quick action buttons (New Calculation, Import Ingredients, etc.)
  - [ ] Implement icon buttons with labels
  - [ ] Add navigation handlers to appropriate routes
  - [ ] Style with Material UI SpeedDial or Grid
  - [ ] Make responsive for mobile
  - [ ] Create Storybook stories
  - [ ] Write tests for navigation

- [ ] **Task 5: Add empty state handling** (AC: 6)
  - [ ] Use existing EmptyState component from shared/ui
  - [ ] Create different empty state messages for each section
  - [ ] Add illustrations or icons for visual appeal
  - [ ] Include call-to-action buttons
  - [ ] Test empty state rendering

- [ ] **Task 6: Connect to Redux store** (AC: 2, 3, 5)
  - [ ] Create dashboard slice at `src/features/dashboard/model/dashboardSlice.ts`
  - [ ] Add actions for fetching recent data
  - [ ] Create selectors for dashboard data
  - [ ] Implement data fetching on mount
  - [ ] Add error handling for failed fetches
  - [ ] Write tests for Redux logic

- [ ] **Task 7: Implement data fetching** (AC: 2, 3, 5)
  - [ ] Create API service functions for dashboard data
  - [ ] Implement caching strategy for dashboard data
  - [ ] Add refresh functionality
  - [ ] Handle loading and error states
  - [ ] Test API integration

## Dev Notes

### Previous Story Context
Story 8.1 has created the application shell with:
- AppLayout component with header and sidebar
- Navigation state management
- Theme switching capability
- Loading overlay component

### Architecture References

#### Tech Stack [Source: architecture/tech-stack.md]
- **TypeScript**: 5.7+ with strict mode
- **Frontend Framework**: Next.js 15.5.2
- **UI Library**: Material UI 7.3.2
- **State Management**: Redux Toolkit 2.8.2
- **Database**: Firestore for data persistence

#### Project Structure [Source: architecture/source-tree.md]
Dashboard components location:
```
src/
├── app/(dashboard)/
│   └── page.tsx           # Dashboard page (new)
├── pages/home/           # Home page slice
│   ├── ui/
│   │   └── RecentActivity.tsx  # Recent items (new)
│   └── index.ts
├── features/dashboard/   # Dashboard feature (new)
│   ├── model/
│   │   └── dashboardSlice.ts
│   └── index.ts
└── shared/ui/molecules/
    ├── StatCard/         # Statistics card (new)
    ├── QuickActionGrid/  # Quick actions (new)
    └── EmptyState/       # Empty state (exists)
```

#### Data Models [Source: architecture/data-models.md]
```typescript
// Dashboard-specific models
interface DashboardData {
  user: {
    name: string;
    lastLogin: Date;
  };
  recentCalculations: TPNCalculation[];
  recentIngredients: Ingredient[];
  statistics: {
    totalCalculations: number;
    totalIngredients: number;
    weeklyActivity: number;
  };
}

interface TPNCalculation {
  id: string;
  patientId: string;
  date: Date;
  populationType: PopulationType;
  status: 'draft' | 'completed';
}

interface Ingredient {
  id: string;
  name: string;
  category: string;
  lastModified: Date;
  isShared: boolean;
}
```

#### Component Standards [Source: architecture/components.md]
- Use Material UI Card for stat cards
- Material UI List for recent activity
- Follow responsive grid system
- Implement loading skeletons for async data
- Error boundaries for data fetching failures

#### State Management [Source: architecture/frontend-architecture.md]
```typescript
// Dashboard state slice
interface DashboardState {
  recentCalculations: TPNCalculation[];
  recentIngredients: Ingredient[];
  statistics: DashboardStatistics;
  isLoading: boolean;
  error: string | null;
  lastRefreshed: Date | null;
}
```

### Component Dependencies
**Existing Components to Use:**
- Card (Material UI)
- List, ListItem (Material UI)
- EmptyState (shared/ui)
- Skeleton (Material UI)
- Grid (Material UI)

**New Components to Create:**
- StatCard - molecule for displaying statistics
- QuickActionGrid - molecule for action buttons
- RecentActivity - page-specific component

### Quick Actions Definition
1. **New TPN Calculation** → `/tpn/calculator`
2. **Import Ingredients** → `/ingredients/import`
3. **View All Calculations** → `/tpn/history`
4. **Manage Ingredients** → `/ingredients/manage`
5. **Create Document** → `/editor/new`
6. **Compare Populations** → `/tpn/compare`

### Empty State Messages
- **No calculations**: "Start your first TPN calculation"
- **No ingredients**: "Import or create your first ingredient"
- **New user**: "Welcome! Let's get you started with a quick tour"

### Testing Requirements

#### Testing Standards [Source: architecture/testing-strategy.md]
- **Test Location**: `__tests__` folders adjacent to components
- **Framework**: Vitest 3.2.4
- **Mock Strategy**: Mock Firestore calls for data fetching

Key Test Scenarios:
1. Dashboard renders with user data
2. Recent items display correctly with formatting
3. Empty states show for new users
4. Statistics calculate and format properly
5. Quick actions navigate to correct routes
6. Loading states display during data fetch
7. Error states handle failed API calls
8. Responsive layout works at all breakpoints

### Performance Considerations
- Lazy load dashboard sections
- Cache dashboard data for 5 minutes
- Use React.memo for StatCard components
- Implement virtual scrolling if lists grow

### Accessibility Requirements
- Keyboard navigation for quick actions
- Screen reader announcements for stats
- Proper heading hierarchy (h1 for welcome)
- ARIA labels for icon buttons
- Focus management for quick actions

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-06 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record
_To be populated by development agent_

### Agent Model Used
_To be populated_

### Debug Log References
_To be populated_

### Completion Notes List
_To be populated_

### File List
_To be populated_

## QA Results
_To be populated by QA agent_